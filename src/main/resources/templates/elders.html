<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>ğŸ‘´ è€äººç®¡ç†</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <style>
        .action-buttons {
            display: inline-flex;
            gap: 0.5rem; /* æŒ‰é’®ä¹‹é—´ 8px é—´è· */
        }

        .action-buttons form {
            margin: 0; /* å»æ‰é»˜è®¤çš„ä¸Šä¸‹ margin */
        }

        .col-actions {
            white-space: nowrap;
            width: 1%;
        }

        /* åˆ†é¡µæ ·å¼ â€”â€” è·ŸæŠ¤ç†è®¡åˆ’é‚£é¡µä¸€æ¨¡ä¸€æ · */
        .btn,
        .page-link {
            text-decoration: none;
        }

        .pagination {
            list-style: none;
            margin: 1rem 0;
            padding: 0;
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        .pagination li {
            margin: 0;
        }

        .pagination li.disabled .btn {
            opacity: 0.5;
            pointer-events: none;
        }

        .pagination li.active .btn {
            background: #357ABD;
            color: #fff;
        }
    </style>
</head>
<body>

<!-- å¤´éƒ¨ã€å¯¼èˆªç›´æ¥æ’å…¥ -->
<div th:insert="~{fragments :: site-header}"></div>
<div th:insert="~{fragments :: site-nav}"></div>

<main class="container">
    <section class="card">
        <h2>â• æ–°å¢è€äºº</h2>
        <form th:action="@{/elders/add}" method="post" th:object="${elder}">
            <label>
                å§“åï¼š
                <input type="text" th:field="*{name}" required/>
            </label><br/>
            <label>
                æ€§åˆ«ï¼š
                <select th:field="*{gender}" required>
                    <option value="" disabled selected>è¯·é€‰æ‹©</option>
                    <option value="M">M</option>
                    <option value="F">F</option>
                </select>
            </label><br/>
            <label>
                èº«ä»½è¯ï¼š
                <input type="text" th:field="*{idCard}" required/>
            </label><br/>
            <label>
                å¹´é¾„ï¼š
                <input type="number" th:field="*{age}" required min="0"/>
            </label><br/>
            <label>
                è”ç³»ç”µè¯ï¼š
                <input type="text" th:field="*{contact}" required/>
            </label><br/>
            <label>
                åœ°å€ï¼š
                <input type="text" th:field="*{address}" required/>
            </label><br/>
            <label>
                è¿‡æ•å²ï¼š
                <input type="text" th:field="*{allergies}" required/>
            </label><br/>
            <label>
                ç—…å²ï¼š
                <input type="text" th:field="*{medicalHistory}" required/>
            </label><br/>
            <label>
                ç´§æ€¥è”ç³»äººï¼š
                <input type="text" th:field="*{emergencyContact}" required/>
            </label><br/>
            <label>
                æœºæ„IDï¼š
                <input type="number" th:field="*{institutionId}" required min="1"/>
            </label><br/>
            <button type="submit">æäº¤</button>
        </form>
    </section>


    <section class="card">
        <h2>ğŸ“‹ è€äººåˆ—è¡¨</h2>
        <!-- æ•´å—åŒ…ä¸€ä¸ª fragment -->
        <div id="elderTable" th:fragment="elderTable">
            <table class="table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>å§“å</th>
                    <th>æ€§åˆ«</th>
                    <th>å¹´é¾„</th>
                    <th class="col-actions">æ“ä½œ</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="e : ${elders}">
                    <td th:text="${e.elderId}">1</td>
                    <td th:text="${e.name}">å¼ ä¸‰</td>
                    <td th:text="${e.gender}">M</td>
                    <td th:text="${e.age}">75</td>
                    <td class="col-actions">
                        <div class="action-buttons">
                            <!-- æŸ¥çœ‹è¯¦æƒ… -->
                            <form th:action="@{|/elders/${e.elderId}|}" method="get">
                                <button type="submit" class="btn">è¯¦æƒ…</button>
                            </form>
                            <!-- å½’æ¡£ -->
                            <form th:action="@{|/elders/${e.elderId}/archive|}" method="post"
                                  onsubmit="return confirm('ç¡®è®¤è¦å½’æ¡£æ­¤è€äººï¼Ÿ');">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <button type="submit" class="btn">å½’æ¡£</button>
                            </form>
                            <!-- åˆ é™¤ -->
                            <form th:action="@{|/elders/${e.elderId}/delete|}" method="post"
                                  onsubmit="return confirm('ç¡®è®¤è¦åˆ é™¤æ­¤è€äººï¼Ÿ');">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <button type="submit" class="btn danger">åˆ é™¤</button>
                            </form>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>

            <!-- åˆ†é¡µæ¡ -->
            <ul class="pagination">
                <!-- ä¸Šä¸€é¡µ -->
                <li th:classappend="${pageInfo.hasPreviousPage} ? '' : 'disabled'">
                    <a href="#"
                       th:attr="data-page=${pageInfo.prePage}"
                       class="btn page-link">ğŸ‘ˆ</a>
                </li>
                <!-- ä¸­é—´é¡µç  -->
                <li th:each="i : ${#numbers.sequence(1, pageInfo.pages)}"
                    th:classappend="${i == pageInfo.pageNum} ? 'active'">
                    <a href="#"
                       th:attr="data-page=${i}"
                       class="btn page-link"
                       th:text="${i}">1</a>
                </li>
                <!-- ä¸‹ä¸€é¡µ -->
                <li th:classappend="${pageInfo.hasNextPage} ? '' : 'disabled'">
                    <a href="#"
                       th:attr="data-page=${pageInfo.nextPage}"
                       class="btn page-link">ğŸ‘‰</a>
                </li>
            </ul>
        </div>
    </section>
</main>

<div th:insert="~{fragments :: site-footer}"></div>

<!-- AJAX åˆ†é¡µè„šæœ¬ -->
<script>
    document.addEventListener('click', e => {
        if (e.target.matches('.page-link')) {
            e.preventDefault();
            const page = e.target.getAttribute('data-page');
            fetch(`/elders?pageNum=${page}`, {
                headers: {'X-Requested-With': 'XMLHttpRequest'}
            })
                .then(r => r.text())
                .then(html => {
                    const frag = document.createRange()
                        .createContextualFragment(html);
                    const newTbl = frag.querySelector('#elderTable');
                    document.querySelector('#elderTable')
                        .replaceWith(newTbl);
                });
        }
    });
</script>
</body>
</html>
