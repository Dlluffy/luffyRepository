<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ğŸ“ æŠ¤ç†è®¡åˆ’ç®¡ç†</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
</head>
<style>
    .action-buttons {
        display: inline-flex;
        gap: 0.5rem; /* æŒ‰é’®ä¹‹é—´ 8px é—´è· */
    }

    .action-buttons form {
        margin: 0; /* å»æ‰é»˜è®¤çš„ä¸Šä¸‹ margin */
    }

    .col-actions {
        white-space: nowrap;
        width: 1%;
    }

    /* å»æ‰æ‰€æœ‰ .btn/.page-link çš„ä¸‹åˆ’çº¿ */
    .btn,
    .page-link {
        text-decoration: none;
    }

    /* å–æ¶ˆ ul é»˜è®¤çš„åœ†ç‚¹ã€å†…å¤–è¾¹è·ï¼Œæ”¹æˆ flex å¸ƒå±€ */
    .pagination {
        list-style: none; /* å»æ‰å°åœ†ç‚¹ */
        margin: 1rem 0; /* ä½ å¯ä»¥æ ¹æ®éœ€è¦è‡ªå·±è°ƒä¸Šä¸‹é—´è· */
        padding: 0;
        display: flex; /* æ¨ªå‘æ’åˆ—å­å…ƒç´  */
        justify-content: flex-end; /* é å³å¯¹é½ */
        gap: 0.5rem; /* æŒ‰é’®ä¹‹é—´é—´éš” 8px */
    }

    /* li æœ¬èº«ä¸ç”¨é¢å¤–é—´è·ï¼Œé‡ç½®é»˜è®¤ */
    .pagination li {
        margin: 0;
    }

    /* disabled çŠ¶æ€æŒ‰é’®æ ·å¼ï¼ˆå¯é€‰ï¼‰ */
    .pagination li.disabled .btn {
        opacity: 0.5;
        pointer-events: none;
    }

    /* active çŠ¶æ€æŒ‰é’®æ ·å¼ï¼ˆå¯é€‰ï¼Œå’Œ .btn.primary ä¸€è‡´å³å¯ï¼‰*/
    .pagination li.active .btn {
        background: #357ABD;
        color: #fff;
    }

</style>
<body>
<!-- é¡µå¤´ + å¯¼èˆª -->
<div th:insert="fragments :: header"></div>
<div th:insert="fragments :: nav"></div>

<!-- ä¸»ä½“ -->
<main class="container">
    <section class="card">
        <h2>ğŸ’¼ æŠ¤ç†è®¡åˆ’åˆ—è¡¨</h2>
        <!-- æ–°å¢ï¼šåŒ…è£¹è¡¨æ ¼+åˆ†é¡µ -->
        <div id="planTable" th:fragment="planTable">
            <table class="table">
                <thead>
                <tr>
                    <th>æŠ¤ç†è®¡åˆ’ID</th>
                    <th>è€äººID</th>
                    <th>è€äººå§“å</th>
                    <th>ç­‰çº§</th>
                    <th>çŠ¶æ€</th>
                    <th>åˆ›å»ºæ—¶é—´</th>
                    <th class="col-actions">æ“ä½œ</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="p : ${plans}">
                    <td th:text="${p.planId}">1</td>
                    <td th:text="${p.elderId}">101</td>
                    <td th:text="${elderNames[p.elderId]}">åˆ˜è€å…ˆç”Ÿ</td>
                    <td th:text="${p.level}">å…¨æŠ¤</td>
                    <td th:text="${p.status}">å¯ç”¨</td>
                    <td th:text="${#dates.format(p.createdAt,'yyyy-MM-dd HH:mm')}">2025-05-07 09:00</td>
                    <td class="col-actions">
                        <div class="action-buttons">
                            <form th:action="@{|/care-plans/${p.planId}/tasks|}" method="GET">
                                <button type="submit" class="btn">æŸ¥çœ‹</button>
                            </form>
                            <!-- å½’æ¡£ -->

                            <form th:action="@{|/care-plans/${p.planId}/archive|}" method="post"
                                  onsubmit="return confirm('ç¡®è®¤è¦å½’æ¡£æ­¤æŠ¤ç†è®¡åˆ’ï¼Ÿ');">
                                <button type="submit" class="btn">å½’æ¡£</button>
                            </form>

                            <!-- åˆ é™¤ -->

                            <form th:action="@{|/care-plans/${p.planId}/delete|}" method="post"
                                  onsubmit="return confirm('ç¡®è®¤è¦åˆ é™¤æ­¤æŠ¤ç†è®¡åˆ’ï¼Ÿ');">
                                <button type="submit" class="btn danger">åˆ é™¤</button>
                            </form>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>

            <!-- åˆ†é¡µæ¡ï¼Œä¹Ÿæ”¾è¿›åŒä¸€ä¸ªå®¹å™¨é‡Œ -->
            <div>
                <ul class="pagination">
                    <!-- ä¸Šä¸€é¡µ -->
                    <li th:classappend="${pageInfo.hasPreviousPage} ? '' : 'disabled'">
                        <a
                                href="#"
                                th:attr="data-page=${pageInfo.prePage}"
                                class="btn page-link">ğŸ‘ˆ</a>
                    </li>
                    <!-- ä¸­é—´é¡µç  -->
                    <li th:each="i : ${#numbers.sequence(1, pageInfo.pages)}"
                        th:classappend="${i == pageInfo.pageNum} ? 'active'">
                        <a
                                href="#"
                                th:attr="data-page=${i}"
                                class="btn page-link"
                                th:text="${i}">1</a>
                    </li>
                    <!-- ä¸‹ä¸€é¡µ -->
                    <li th:classappend="${pageInfo.hasNextPage} ? '' : 'disabled'">
                        <a
                                href="#"
                                th:attr="data-page=${pageInfo.nextPage}"
                                class="btn page-link">ğŸ‘‰</a>
                    </li>
                </ul>
            </div>
        </div>
    </section>

    <section class="card">
        <h2>â• æ–°å»ºæŠ¤ç†è®¡åˆ’</h2>
        <form th:action="@{/care-plans}" th:object="${plan}" method="post" class="form">
            <div class="form-group">
                <label>è€äºº
                    <select th:field="*{elderId}" required>
                        <option value="" disabled selected>è¯·é€‰æ‹©è€äºº</option>
                        <option th:each="e : ${elders}"
                                th:value="${e.elderId}"
                                th:text="${e.name}">
                        </option>
                    </select>
                </label>
            </div>
            <div class="form-group">
                <label>ç­‰çº§
                    <select th:field="*{level}" required>
                        <option value="å…¨æŠ¤">å…¨æŠ¤</option>
                        <option value="åŠæŠ¤">åŠæŠ¤</option>
                        <option value="è‡ªç†">è‡ªç†</option>
                    </select>
                </label>
            </div>
            <div class="form-group">
                <label>ä»»åŠ¡è¯´æ˜ <input type="text" th:field="*{task}" required/></label>
            </div>
            <button class="btn primary" type="submit">ä¿å­˜</button>
        </form>
    </section>
</main>

<!-- é¡µè„š -->
<div th:insert="fragments :: footer"></div>

<script>
    document.addEventListener('click', e => {
        if (e.target.matches('.page-link')) {
            e.preventDefault();
            const page = e.target.getAttribute('data-page');
            fetch(`/care-plans?pageNum=${page}`, {
                headers: {'X-Requested-With': 'XMLHttpRequest'}
            })
                .then(res => res.text())
                .then(html => {
                    const frag = document.createRange()
                        .createContextualFragment(html);
                    const newTable = frag.querySelector('#planTable');
                    document.querySelector('#planTable')
                        .replaceWith(newTable);
                });
        }
    });

</script>

</body>
</html>
